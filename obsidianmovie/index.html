<!doctype html>
<html>

<head>
  <title>Wen Jian</title>
    
  <!-- Meta -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Wen Jian">
  <meta name="author" content="Wen Jian">    
  <link rel="shortcut icon" href="favicon.ico"> 
  
  <!-- FontAwesome JS-->
  <script defer src="/static/fontawesome/js/all.min.js"></script>
  
  <!-- Theme CSS -->  
  <link id="theme-style" rel="stylesheet" href="/static/css/theme-2.css">
  <link rel="stylesheet" type="text/css" href="/static/css/custom.css">
  <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-light.min.css">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B6X3EFF1R0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-B6X3EFF1R0');
  </script>

</head>

<body>
    <header class="header text-center">	    
	    <h1 class="blog-name pt-lg-4 mb-0"><a class="no-text-decoration" href="/">Wen Jian</a></h1>
        
	    <nav class="navbar navbar-expand-lg navbar-dark" >
           
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div id="navigation" class="collapse navbar-collapse flex-column" >
				<div class="profile-section pt-3 pt-lg-0">
				    <img class="profile-image mb-3 rounded-circle mx-auto" src="/static/images/profile.png" alt="image" >			
					
					<div class="bio mb-3">Economist who enjoys using data for social good<br></div><!--//bio-->
					<ul class="social-list list-inline py-3 mx-auto">
			            <li class="list-inline-item"><a href="https://twitter.com/adwenturous"><i class="fab fa-twitter fa-fw"></i></a></li>
			            <li class="list-inline-item"><a href="https://www.linkedin.com/in/wen-jian-48926b32/"><i class="fab fa-linkedin-in fa-fw"></i></a></li>
			            <li class="list-inline-item"><a href="https://github.com/wjivan"><i class="fab fa-github-alt fa-fw"></i></a></li>
			        </ul><!--//social-list-->
			        <hr> 
				</div><!--//profile-section-->
				
          <ul class="navbar-nav flex-column text-start">
            <li class="nav-item">
              <a class="nav-link" href="/"><i class="fas fa-user fa-fw me-2"></i>About Me</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="/projects/"><i class="fas fa-laptop fa-fw me-2"></i>Projects</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="/blogs/"><i class="fas fa-book fa-fw me-2"></i>Blog</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="mailto:wen.jian@cantab.net"><i class="fas fa-paper-plane fa-fw me-2"></i>Get in touch</a>
            </li>
          </ul>
			  </div>
		</nav>
  </header>
    
    <div class="main-wrapper">
	    
	    <section class="cta-section theme-bg-light py-3">
		    <div class="container text-center single-col-max-width">
			    <h5 class="d-flex flex-row-reverse"> 
            <a href="/blogs/" class="text-decoration-none" style="color: black">üè† &nbsp; Economics and data science</a>
          </h5>
          <!-- Note that tags is defined in app.py as a global-->
		    </div><!--//container-->
	    </section>

      
      <div class="container">
        <div class="row px-5 d-flex justify-content-center">
          <div class="col-8 shadow-sm p-3 mb-5 bg-white rounded text-center">
              <p class="heading-minor"><b>Topics I write about:</b></p>
              
              <a href="/tag/Productivity/" class="btn btn-primary btn-xs" role="button" aria-pressed="true">Productivity</a>
              
              <a href="/tag/Web%20scraping/" class="btn btn-primary btn-xs" role="button" aria-pressed="true">Web scraping</a>
              
              <a href="/tag/Visualisation/" class="btn btn-primary btn-xs" role="button" aria-pressed="true">Visualisation</a>
              
              <a href="/tag/Gender%20inequality/" class="btn btn-primary btn-xs" role="button" aria-pressed="true">Gender inequality</a>
              
              <a href="/tag/Network%20analysis/" class="btn btn-primary btn-xs" role="button" aria-pressed="true">Network analysis</a>
              

              
                <a href="/tag/Python/" class="btn btn-secondary btn-xs" role="button" aria-pressed="true">Python</a>
                
                <a href="/tag/R/" class="btn btn-secondary btn-xs" role="button" aria-pressed="true">R</a>
                
        
          </div>
        </div>
      </div>
      

      <!--Main section that other pages would extend goes here-->
      <div class="container">
      <br>
        
<div class="mb-5">
    <h4>Automate movie metadata for Obsidian on IMDB API</h4>
    <!-- <div class="meta"><span class="date">2020-01-15</span></div> -->

    
    <div class="block">
        <b><a href="/tag/Productivity/" class="text-decoration-none">Productivity</a></b>
    </div>
    <!--  |   -->
    
    <div class="block">
        <b><a href="/tag/Python/" class="text-decoration-none">Python</a></b>
    </div>
    <!--   -->
    
</div>

    <div class="blog-post-body pb-5">
        <h6>Motivation</h6>
<p>Obsidian is a great productivity tool that I use to keep my thoughts and ideas in place. One area I want to log and review are movies. When I sat down and listed all my favourite movies, it came down to a list of more than 100 movies! Trying to search through the cast and directors for all these movies is time consuming and I just want to get a quick summary of the movie before trying to write my own thoughts on them. So I decided to use Python to automate this for me. </p>
<h6>How this works</h6>
<ol>
<li>Input all the movies to search into the csv <code>movies_to_search.csv</code>. </li>
<li>The script makes use of the <a href="https://imdbpy.github.io/"><code>imdb</code> package</a> to download the metadata from IMDB. This does not require you to have an IMDB api account. You can check out their documentations on what data is available to adjust as required. I created a function that allows me to down the information regarding:<ul>
<li>title</li>
<li>plot</li>
<li>genre</li>
<li>country</li>
<li>cover url</li>
<li>director</li>
<li>kind</li>
<li>rating</li>
<li>synopsis</li>
<li>year</li>
</ul>
</li>
</ol>
<pre><code>
from imdb import IMDb

def movie_search(my_title):
    """
    Given a string (movie title), find the metadata for that movie (or the closest
    one matching that name).

    Parameters
    ----------
    my_title : string

    returns a dictionary of metadata
    """
    # create a dictionary to store data
    information = dict()

    # create an instance of the IMDb class
    ia = IMDb()

    # search for a movie
    lookups = ia.search_movie(my_title)

    # use the first search result to return the id
    try:
        # Test if any movies are found
        movie_id = lookups[0].movieID

        # get a movie
        movie = ia.get_movie(movie_id)

        # RETRIEVE DATA
        # Get the movie title searched for
        t = movie['title']
        information['title'] = t
        print(f'Retrieving data for {t}')

        # Get the plot outline
        try:
            information['plot'] = movie['plot outline']
        except:
            print('plot outline not available')
            try:
                information['plot'] = movie['plot'][0]
            except:
                print('plot also not available')
                information['plot'] = ''

        # Get the genre
        try:
            information['genre'] = ','.join(movie['genre'])
        except:
            print('no information on genre')
            information['genre'] = ''

        # Get the country
        try:
            information['country'] = ','.join(movie['countries'])
        except:
            print('no information on country')
            information['country'] = ''

        # Get the director
        # Extract the names in each Person object
        try:
            director_names = [d['name'] for d in movie['directors']]
            information['director'] = ','.join(director_names)
        except:
            print('director information not available')
            information['director'] = ''

        # Get the cast
        # Extract the top 5 names in cast (if it exists)
        try:
            cast_names = [d['name'] for d in movie['cast']]
            if len(cast_names) >5:
                cast_names = cast_names[0:5]
            information['cast'] = ','.join(cast_names)
        except:
            print('No information on cast')
            information['cast'] = ''

        # Get the rating
        try:
            information['rating'] = movie['rating']
        except:
            print('rating info is not available')
            information['rating'] = 'N/A'

        # Get the year
        try:
            information['year'] = movie['year']
        except:
            print('no information on year')
            information['year'] = ''

        # Get the type
        try:
            information['kind'] = movie['kind']
        except:
            print('type not available')
            information['kind'] = ''

        # Get the cover url
        try:
            information['cover url'] = movie['cover url']
        except:
            print('cover url not available')
            information['cover url'] = ''

        # Get sypnosis
        try:
            information['synopsis'] = movie['synopsis'][0]
        except:
            print('no synopsis')
            information['synopsis'] = ''
    except:
        print('NO RESULTS FOUND FOR {my_title}')
        information['title'] = my_title
        information['plot'] = ''
        information['genre'] = ''
        information['country'] = ''
        information['cover url'] = ''
        information['director'] = ''
        information['kind'] = ''
        information['rating'] = ''
        information['synopsis'] = ''
        information['year'] = ''

    return(information)
    </code></pre>

<p>Obsidian reads markdown pages so I automate the creation of markdown pages using python using <a href="https://pypi.org/project/mdutils/">mdutils</a>. I create a function to automate the creation of a standard template filled in with the new metadata:</p>
<pre><code>
def create_markdown_page(myresults):
    """
    Given a dataframe containing all the information about movies, 
    we can create individual pages

    Parameters
    ----------
    myresults : DataFrame
        Contains essential headers: title, year, rating, genre, country, director
        cast, synopsis and plot
    """
    # Create iterations
    for index, row in myresults.iterrows():
        # Create a file
        mdFile = MdUtils(file_name=row['title'])

        # Create a metadata section
        mdFile.new_line(text='---\n')
        facts = ['year', 'rating','genre', 'country', 'director', 'cast']
        for f in facts:
            mdFile.new_line(text=f'{f.title()}: {row[f]}')
        mdFile.new_line(text='Type: Review')
        mdFile.new_line(text='')
        mdFile.new_line(text='---\n')

        # Create a title
        mdFile.new_header(level=1, title=row['title'])

        # Create a cover
        # i could use new_inline_image but the text wraps at 20 characters
        # creating a break. Hence, I code my own image line and unwrap it
        cover_link = '!['+ row['title'] + '](' + row['cover url'] + ')'
        mdFile.write(text = cover_link, wrap_width=0)

        # Create a section for the plot
        mdFile.new_header(level=1, title="Plot")

        # Clean up plot text
        plot_text = row['plot']
        plot_text = ' '.join(plot_text.split())
        plot_text = plot_text.replace('\ ','')
        mdFile.new_line(text=plot_text, wrap_width=0)

        # Create my own review section
        mdFile.new_header(level=1, title="My own thoughts")

        # Create markdown
        mdFile.create_md_file()
</code></pre>

<p>You can drag and drop these newly created markdown sheets into Obsidian. For the full code - see my <a href="https://github.com/wjivan/obsidianmovies">github</a></p>
    </div>


      </div>
      
    </div><!--//main-wrapper-->

    <nav class="navfoot py-1">
      <div style="text-align:center;">
        &copy; 2021 |
        &thinsp; <a href="https://www.linkedin.com/in/wen-jian-48926b32/"><i class="fab fa-linkedin fa-lg"></i></a>
        &thinsp; <a href="https://github.com/wjivan"><i class="fab fa-github fa-lg"></i></a> |
      </div>
    </nav>

    <!-- Javascript -->          
    <script src="/static/plugins/popper.min.js"></script> 
    <script src="/static/plugins/bootstrap/js/bootstrap.min.js"></script> 
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        svg: {
          fontCache: 'global'
        }
      };
      </script>
      <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
      </script>
</body>

</html>